# MCCE ç¯å¢ƒé…ç½®è¯´æ˜

MCCEé¡¹ç›®éœ€è¦ä¸¤ä¸ªç‹¬ç«‹çš„condaç¯å¢ƒæ¥è¿è¡Œä¸åŒçš„åŠŸèƒ½æ¨¡å—ã€‚

## ğŸ“¦ ä¸¤ä¸ªç¯å¢ƒçš„ä½œç”¨

### 1. moorl ç¯å¢ƒ - ä¸»ä¼˜åŒ–ç¯å¢ƒ
**ç”¨é€”**: è¿è¡ŒMCCEå¤šç›®æ ‡ä¼˜åŒ–ç®—æ³•

**ä¸»è¦åŠŸèƒ½**:
- æ‰§è¡Œé—ä¼ ç®—æ³•/è¿›åŒ–ç®—æ³•
- è°ƒç”¨LLMç”Ÿæˆå€™é€‰è§£
- è¯„ä¼°å’Œé€‰æ‹©æœ€ä¼˜è§£
- è®°å½•ä¼˜åŒ–å†å²

**ä½¿ç”¨åœºæ™¯**:
```bash
conda activate moorl
python main.py problem/molecules/config.yaml
```

### 2. verl ç¯å¢ƒ - DPOè®­ç»ƒç¯å¢ƒ
**ç”¨é€”**: æ‰§è¡ŒDirect Preference Optimization (DPO) è®­ç»ƒ

**ä¸»è¦åŠŸèƒ½**:
- ä»ä¼˜åŒ–å†å²ç”Ÿæˆè®­ç»ƒæ•°æ®
- å¾®è°ƒæœ¬åœ°Qwenæ¨¡å‹
- æ›´æ–°æ¨¡å‹æƒé‡
- å®éªŒè¿½è¸ªå’Œæ—¥å¿—è®°å½•

**ä½¿ç”¨åœºæ™¯**:
- è‡ªåŠ¨è§¦å‘ï¼šmoorlç¯å¢ƒè¿è¡Œæ—¶è‡ªåŠ¨è°ƒç”¨
- æ‰‹åŠ¨è®­ç»ƒï¼š
```bash
conda activate verl
python tools/makerldata_dpov3.py --exp my_exp --pkl_path results/xxx.pkl
```

## ğŸ”§ ç¯å¢ƒå®‰è£…

### æ–¹æ³•1: ä½¿ç”¨requirementsæ–‡ä»¶ï¼ˆæ¨èï¼‰

#### 1.1 åˆ›å»ºmoorlç¯å¢ƒ
```bash
# åˆ›å»ºç¯å¢ƒ
conda create -n moorl python=3.10

# æ¿€æ´»ç¯å¢ƒ
conda activate moorl

# å®‰è£…ä¾èµ–
pip install -r requirements_moorl.txt

# å¦‚æœéœ€è¦åˆ†å­ä¼˜åŒ–åŠŸèƒ½ï¼Œé¢å¤–å®‰è£…rdkit
conda install -c conda-forge rdkit
```

#### 1.2 åˆ›å»ºverlç¯å¢ƒ
```bash
# åˆ›å»ºç¯å¢ƒ
conda create -n verl python=3.10

# æ¿€æ´»ç¯å¢ƒ
conda activate verl

# å®‰è£…ä¾èµ–
pip install -r requirements_verl.txt

# å®‰è£…PyTorch (æ ¹æ®ä½ çš„CUDAç‰ˆæœ¬)
# CUDA 12.1:
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121

# æˆ– CUDA 11.8:
# pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
```

### æ–¹æ³•2: ä»ç°æœ‰ç¯å¢ƒå…‹éš†

å¦‚æœä½ å·²ç»æœ‰é…ç½®å¥½çš„ç¯å¢ƒï¼š

```bash
# å¯¼å‡ºç°æœ‰ç¯å¢ƒ
conda activate moorl
conda env export > environment_moorl.yml

conda activate verl
conda env export > environment_verl.yml

# åœ¨æ–°æœºå™¨ä¸Šåˆ›å»ºç¯å¢ƒ
conda env create -f environment_moorl.yml
conda env create -f environment_verl.yml
```

## ğŸ“‹ ä¾èµ–è¯´æ˜

### moorlç¯å¢ƒæ ¸å¿ƒä¾èµ–

| åŒ…å | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| torch | >=2.0.0 | æ·±åº¦å­¦ä¹ æ¡†æ¶ |
| transformers | >=4.30.0 | HuggingFaceæ¨¡å‹ |
| pymoo | >=0.6.0 | å¤šç›®æ ‡ä¼˜åŒ– |
| pygmo | >=2.19.0 | å…¨å±€ä¼˜åŒ–ç®—æ³• |
| openai | >=1.0.0 | OpenAI API |
| google-generativeai | >=0.8.0 | Gemini API |
| pytdc | >=0.3.0 | åˆ†å­æ•°æ®åº“ |

### verlç¯å¢ƒæ ¸å¿ƒä¾èµ–

| åŒ…å | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| torch | >=2.0.0 | æ·±åº¦å­¦ä¹ æ¡†æ¶ |
| transformers | >=4.30.0 | HuggingFaceæ¨¡å‹ |
| trl | >=0.7.0 | DPOè®­ç»ƒæ ¸å¿ƒ |
| accelerate | >=1.0.0 | åˆ†å¸ƒå¼è®­ç»ƒ |
| swanlab | >=0.3.0 | å®éªŒè¿½è¸ª |
| flash-attn | >=2.0.0 | æ³¨æ„åŠ›åŠ é€Ÿ |
| peft | >=0.10.0 | å‚æ•°é«˜æ•ˆå¾®è°ƒ |

## ğŸ” éªŒè¯å®‰è£…

### éªŒè¯moorlç¯å¢ƒ
```bash
conda activate moorl

# æ£€æŸ¥Pythonç‰ˆæœ¬
python --version  # åº”è¯¥æ˜¯ 3.10.x

# æ£€æŸ¥æ ¸å¿ƒåŒ…
python -c "import torch; print('torch:', torch.__version__)"
python -c "import transformers; print('transformers:', transformers.__version__)"
python -c "import pymoo; print('pymoo OK')"
python -c "from algorithm.MOO import MOO; print('MCCE import OK')"

# æµ‹è¯•MCCEå¯¼å…¥
python -c "from model.MOLLM import MOLLM; print('MOLLM import OK')"
```

### éªŒè¯verlç¯å¢ƒ
```bash
conda activate verl

# æ£€æŸ¥Pythonç‰ˆæœ¬
python --version  # åº”è¯¥æ˜¯ 3.10.x

# æ£€æŸ¥æ ¸å¿ƒåŒ…
python -c "import torch; print('torch:', torch.__version__)"
python -c "import trl; print('trl:', trl.__version__)"
python -c "import swanlab; print('swanlab:', swanlab.__version__)"

# æ£€æŸ¥CUDAå¯ç”¨æ€§
python -c "import torch; print('CUDA available:', torch.cuda.is_available())"
python -c "import torch; print('CUDA version:', torch.version.cuda)"
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡ŒåŸºæœ¬ä¼˜åŒ–ï¼ˆmoorlç¯å¢ƒï¼‰
```bash
conda activate moorl
python main.py problem/circle_packing/config.yaml
```

### 2. è¿è¡Œå¸¦DPOè®­ç»ƒçš„ä¼˜åŒ–ï¼ˆè‡ªåŠ¨åˆ‡æ¢ç¯å¢ƒï¼‰
```bash
# moorlç¯å¢ƒè¿è¡Œä¸»ç¨‹åº
conda activate moorl
python main.py problem/molecules/config.yaml

# DPOè®­ç»ƒä¼šè‡ªåŠ¨åœ¨verlç¯å¢ƒä¸­æ‰§è¡Œ
# ä¸éœ€è¦æ‰‹åŠ¨åˆ‡æ¢ç¯å¢ƒ
```

### 3. æ‰‹åŠ¨æ‰§è¡ŒDPOè®­ç»ƒï¼ˆverlç¯å¢ƒï¼‰
```bash
conda activate verl
python tools/makerldata_dpov3.py \
  --exp my_experiment \
  --pkl_path results/your_result.pkl \
  --ref_model_path /path/to/Qwen2.5-7B-Instruct
```

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªç¯å¢ƒï¼Ÿ
A: ä¸¤ä¸ªç¯å¢ƒçš„ä¾èµ–åŒ…ç‰ˆæœ¬å¯èƒ½å†²çªï¼Œåˆ†å¼€å¯ä»¥é¿å…é—®é¢˜ï¼š
- moorl: éœ€è¦å¤šç§ä¼˜åŒ–ç®—æ³•åº“
- verl: éœ€è¦æœ€æ–°çš„è®­ç»ƒåº“ï¼ˆtrl, peftç­‰ï¼‰

### Q2: å¯ä»¥åˆå¹¶æˆä¸€ä¸ªç¯å¢ƒå—ï¼Ÿ
A: æŠ€æœ¯ä¸Šå¯ä»¥ï¼Œä½†ä¸æ¨èï¼š
- ä¾èµ–åŒ…æ›´å¤šï¼Œå®‰è£…æ›´å¤æ‚
- ç‰ˆæœ¬å†²çªé£é™©å¢åŠ 
- ç¯å¢ƒæ›´éš¾ç»´æŠ¤

### Q3: å¦‚ä½•åœ¨æ²¡æœ‰GPUçš„æœºå™¨ä¸Šè¿è¡Œï¼Ÿ
A: moorlç¯å¢ƒå¯ä»¥ç”¨CPUè¿è¡Œï¼ˆè¾ƒæ…¢ï¼‰ï¼Œä½†verlç¯å¢ƒå¼ºçƒˆå»ºè®®ä½¿ç”¨GPUè¿›è¡ŒDPOè®­ç»ƒã€‚

### Q4: Flash Attentionå®‰è£…å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: Flash Attentionéœ€è¦ç‰¹å®šçš„CUDAç‰ˆæœ¬å’Œç¼–è¯‘ç¯å¢ƒï¼š
```bash
# å¦‚æœå®‰è£…å¤±è´¥ï¼Œå¯ä»¥è·³è¿‡
# ç¨‹åºä¼šè‡ªåŠ¨å›é€€åˆ°æ ‡å‡†æ³¨æ„åŠ›æœºåˆ¶
pip install flash-attn --no-build-isolation
```

### Q5: å¦‚ä½•æ›´æ–°ç¯å¢ƒï¼Ÿ
```bash
# æ›´æ–°moorl
conda activate moorl
pip install -r requirements_moorl.txt --upgrade

# æ›´æ–°verl
conda activate verl
pip install -r requirements_verl.txt --upgrade
```

## ğŸ“ ç¯å¢ƒå¯¼å‡ºå’Œè¿ç§»

### å¯¼å‡ºå®Œæ•´ç¯å¢ƒé…ç½®
```bash
# moorlç¯å¢ƒ
conda activate moorl
pip freeze > requirements_moorl_full.txt
conda env export > environment_moorl.yml

# verlç¯å¢ƒ
conda activate verl
pip freeze > requirements_verl_full.txt
conda env export > environment_verl.yml
```

### åœ¨æ–°æœºå™¨ä¸Šé‡å»ºç¯å¢ƒ
```bash
# ä½¿ç”¨conda ymlæ–‡ä»¶ï¼ˆæ¨èï¼ŒåŒ…å«æ‰€æœ‰ä¾èµ–ï¼‰
conda env create -f environment_moorl.yml
conda env create -f environment_verl.yml

# æˆ–ä½¿ç”¨pip requirementsï¼ˆæ›´é€šç”¨ï¼‰
conda create -n moorl python=3.10
conda activate moorl
pip install -r requirements_moorl.txt

conda create -n verl python=3.10
conda activate verl
pip install -r requirements_verl.txt
```

## ğŸ’¾ ç£ç›˜ç©ºé—´éœ€æ±‚

- moorlç¯å¢ƒ: ~5-8 GB
- verlç¯å¢ƒ: ~8-12 GB
- æ€»è®¡: ~15-20 GB

å»ºè®®é¢„ç•™è‡³å°‘ 30GB çš„ç£ç›˜ç©ºé—´ç”¨äºç¯å¢ƒå’Œæ¨¡å‹å­˜å‚¨ã€‚

## ğŸ”— ç›¸å…³é“¾æ¥

- PyTorchå®‰è£…: https://pytorch.org/get-started/locally/
- HuggingFaceæ–‡æ¡£: https://huggingface.co/docs
- TRLæ–‡æ¡£: https://huggingface.co/docs/trl
- MCCEé¡¹ç›®: https://github.com/your-repo/MCCE

---

**æ›´æ–°æ—¶é—´**: 2025-11-20  
**MCCEç‰ˆæœ¬**: 1.0.0

